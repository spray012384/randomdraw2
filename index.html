<!-- Version: 1.3.1 --><!DOCTYPE html><html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>뽑기판 설정</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: sans-serif; margin: 0; padding: 20px; }
    h1, .subtitle { font-size: 24px; margin-bottom: 10px; }
    label { display: block; margin-top: 15px; font-weight: bold; }
    input[type="text"], input[type="number"] {
      width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box;
    }
    .section { margin-bottom: 20px; border-bottom: 1px solid #ddd; padding-bottom: 20px; }
    .radio-group label { font-weight: normal; display: inline-block; margin-right: 10px; }
    .preview-board { margin-top: 20px; display: grid; gap: 5px; justify-content: center; }
    .preview-cell {
      background: #f0f0f0; width: 60px; height: 60px;
      display: flex; align-items: center; justify-content: center;
    }
    button {
      padding: 10px 20px; margin-right: 10px; margin-top: 20px;
      border: none; border-radius: 5px; cursor: pointer;
    }
    .start-btn { background-color: #007bff; color: white; }
    .gray-btn { background-color: #ccc; color: black; }
    .version { margin-top: 30px; font-size: 12px; color: gray; text-align: center; }
    .image-upload { margin-top: 10px; }
    .thumbnail { width: 40px; height: 40px; object-fit: cover; margin-right: 5px; }
  </style>
</head>
<body>
  <h1>뽑기판 설정</h1>  <div class="section">
    <label>메인 타이틀</label>
    <input type="text" id="mainTitle" placeholder="예: 신년맞이 경품 이벤트" />
    <div id="subtitleSection" style="display:none;">
      <label class="subtitle">서브 타이틀</label>
      <input type="text" id="itemInfo" readonly />
    </div>
  </div>  <div class="section">
    <label>가로 / 세로 / 당첨 개수</label>
    <input type="number" id="cols" placeholder="가로 (예: 3)" min="1" max="10" />
    <input type="number" id="rows" placeholder="세로 (예: 3)" min="1" max="10" />
    <input type="number" id="winCount" placeholder="당첨 개수 (예: 2)" min="1" />
    <div id="countMsg" style="color: red; display: none;"></div>
  </div>  <div class="section">
    <label>당첨 방식 선택</label>
    <div class="radio-group">
      <label><input type="radio" name="winType" value="basic" checked /> 꽝 / 당첨</label>
      <label><input type="radio" name="winType" value="custom" /> 직접 텍스트 입력</label>
    </div>
    <div id="customWinInputs"></div>
  </div>  <div class="section">
    <label>셀 UI 설정</label>
    <div class="radio-group">
      <label><input type="radio" name="cellUi" value="default" checked /> 기본</label>
      <label><input type="radio" name="cellUi" value="text" /> 텍스트 입력</label>
      <label><input type="radio" name="cellUi" value="image" /> 이미지 업로드</label>
    </div>
    <div id="cellImageUpload" class="image-upload" style="display: none;"></div>
  </div>  <div id="preview" class="preview-board"></div><button class="start-btn" onclick="startGame()">시작하기</button> <button class="gray-btn">저장하기</button> <button class="gray-btn" onclick="location.reload()">초기화</button>

  <div class="version">Version 1.3.1</div>  <script>
    const get = id => document.getElementById(id);
    const winInputsDiv = get("customWinInputs");
    const itemInfoInput = get("itemInfo");

    document.querySelectorAll("input[name='winType']").forEach(r => {
      r.addEventListener("change", () => {
        const isCustom = r.value === "custom";
        get("subtitleSection").style.display = isCustom ? 'block' : 'none';
        renderCustomWinInputs();
      });
    });

    ["rows", "cols", "winCount"].forEach(id => {
      get(id).addEventListener("input", validateInputs);
    });

    document.querySelectorAll("input[name='cellUi']").forEach(radio => {
      radio.addEventListener("change", () => {
        const type = document.querySelector("input[name='cellUi']:checked").value;
        const uploadDiv = get("cellImageUpload");
        uploadDiv.style.display = type === 'image' ? 'block' : 'none';
        if (type === 'image') renderImageUploadInputs();
        else uploadDiv.innerHTML = '';
      });
    });

    function renderCustomWinInputs() {
      const count = parseInt(get("winCount").value || 0);
      const isCustom = document.querySelector("input[name='winType']:checked").value === 'custom';
      winInputsDiv.innerHTML = '';
      if (isCustom && count > 0) {
        for (let i = 0; i < count; i++) {
          const input = document.createElement("input");
          input.type = "text";
          input.placeholder = `상품 ${i + 1}`;
          input.oninput = updateItemInfo;
          winInputsDiv.appendChild(input);
        }
      } else itemInfoInput.value = '';
    }

    function updateItemInfo() {
      const values = Array.from(winInputsDiv.querySelectorAll("input"))
        .map(i => i.value).filter(v => v);
      itemInfoInput.value = values.join(', ');
    }

    function renderImageUploadInputs() {
      const rows = parseInt(get("rows").value || 0);
      const cols = parseInt(get("cols").value || 0);
      const uploadDiv = get("cellImageUpload");
      uploadDiv.innerHTML = '';
      for (let i = 0; i < rows * cols; i++) {
        const input = document.createElement("input");
        input.type = "file";
        input.accept = "image/*";
        input.onchange = e => showThumbnail(e);
        uploadDiv.appendChild(input);
      }
    }

    function showThumbnail(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        const img = document.createElement("img");
        img.src = e.target.result;
        img.className = "thumbnail";
        event.target.insertAdjacentElement('afterend', img);
      };
      reader.readAsDataURL(file);
    }

    function validateInputs() {
      const rows = parseInt(get("rows").value || 0);
      const cols = parseInt(get("cols").value || 0);
      const count = parseInt(get("winCount").value || 0);
      const msg = get("countMsg");
      const max = rows * cols - 1;

      if (count > rows * cols) {
        msg.style.display = 'block';
        msg.textContent = `당첨갯수는 ${rows * cols}개를 초과할 수 없습니다.`;
      } else if (count > max) {
        msg.style.display = 'block';
        msg.textContent = `당첨갯수는 ${max}개를 초과할 수 없습니다.`;
      } else msg.style.display = 'none';

      renderCustomWinInputs();
      generatePreview();
    }

    function generatePreview() {
      const rows = parseInt(get("rows").value || 3);
      const cols = parseInt(get("cols").value || 3);
      const board = get("preview");
      board.innerHTML = '';
      board.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
      for (let i = 0; i < rows * cols; i++) {
        const cell = document.createElement("div");
        cell.className = "preview-cell";
        cell.textContent = i + 1;
        board.appendChild(cell);
      }
    }

    function startGame() {
      const settings = {
        title: get("mainTitle").value,
        itemInfo: get("itemInfo").value,
        rows: parseInt(get("rows").value),
        cols: parseInt(get("cols").value),
        winCount: parseInt(get("winCount").value),
        winType: document.querySelector("input[name='winType']:checked").value,
        cellUi: document.querySelector("input[name='cellUi']:checked").value
      };
      const winTexts = Array.from(winInputsDiv.querySelectorAll("input")).map(i => i.value);
      const url = `game.html?settings=${encodeURIComponent(JSON.stringify(settings))}&wtexts=${encodeURIComponent(JSON.stringify(winTexts))}`;
      window.open(url, '_blank');
    }
  </script></body>
</html>
